<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Carrito de Compras - Burger House</title>
        <link rel="stylesheet" href="../css/main.css" />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet" />
        <script type="module"
            src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fburgerhou6626back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
    </head>
    <body class="bg-background min-h-screen">
        <!-- Header Navigation -->
        <header
            class="bg-surface shadow-sm border-b border-border-light sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <!-- Logo -->
                    <div class="flex items-center">
                        <a href="product_catalog.html"
                            class="flex items-center space-x-2">
                            <div
                                class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                                <img
                                    src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNGRkY0QzMiLz4KPHN2ZyB4PSI1IiB5PSI1IiB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAzMCAzMCIgZmlsbD0ibm9uZSI+CjxyZWN0IHdpZHRoPSIzMCIgaGVpZ2h0PSIyMCIgeD0iMCIgeT0iNSIgcng9IjMiIGZpbGw9IiNGRkQ3MDAiLz4KPHJlY3Qgd2lkdGg9IjMwIiBoZWlnaHQ9IjEwIiB4PSIwIiB5PSIxNSIgcng9IjMiIGZpbGw9IiNGRkQ3MDAiLz4KPHJlY3Qgd2lkdGg9IjMwIiBoZWlnaHQ9IjEwIiB4PSIwIiB5PSIyNSIgcng9IjMiIGZpbGw9IiNGRkQ3MDAiLz4KPHJlY3Qgd2lkdGg9IjMwIiBoZWlnaHQ9IjEwIiB4PSIwIiB5PSIwIiByeD0iMyIgZmlsbD0iI0ZGRDcwMCIvPgo8L3N2Zz4KPC9zdmc+"
                                    alt="Hamburguesa" class="w-6 h-6">
                            </div>
                            <span
                                class="text-xl font-bold text-text-primary">Burger
                                House</span>
                        </a>
                    </div>

                    <!-- Search Bar (Desktop) -->
                    <div class="hidden md:flex flex-1 max-w-md mx-8">
                        <div class="relative w-full">
                            <input type="search" id="searchInput"
                                placeholder="Buscar hamburguesas, combos..."
                                class="input-field pl-10 pr-4" />
                            <div
                                class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i
                                    class="fas fa-search text-text-secondary"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Cart & Menu -->
                    <div class="flex items-center space-x-4">
                        <!-- Cart Button -->
                        <button id="cartToggle"
                            class="relative p-2 text-primary hover:text-primary-600 transition-colors touch-target">
                            <i class="fas fa-shopping-cart text-xl"></i>
                            <span id="cartBadge"
                                class="absolute -top-1 -right-1 bg-accent text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium hidden">0</span>
                        </button>

                        <!-- Mobile Menu Toggle -->
                        <button id="mobileMenuToggle"
                            class="md:hidden p-2 text-text-primary hover:text-primary transition-colors touch-target">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                    </div>
                </div>

                <!-- Mobile Search (Hidden by default) -->
                <div id="mobileSearch" class="md:hidden pb-4 hidden">
                    <div class="relative">
                        <input type="search" id="mobileSearchInput"
                            placeholder="Buscar hamburguesas, combos..."
                            class="input-field pl-10 pr-4" />
                        <div
                            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-text-secondary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Mobile Navigation Menu -->
        <nav id="mobileNav"
            class="md:hidden bg-surface border-b border-border-light hidden">
            <div class="px-4 py-2 space-y-1">
                <a href="product_catalog.html"
                    class="block px-3 py-2 text-text-primary hover:text-primary transition-colors">Catálogo</a>
                <a href="shopping_cart.html"
                    class="block px-3 py-2 text-primary font-medium">Carrito</a>
                <a href="order_tracking.html"
                    class="block px-3 py-2 text-text-primary hover:text-primary transition-colors">Seguir
                    Pedido</a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <!-- Page Header -->
            <div class="mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1
                            class="text-2xl md:text-3xl font-bold text-text-primary mb-2">Tu
                            Carrito</h1>
                        <p class="text-text-secondary">Revisa tus productos y
                            procede al pago</p>
                    </div>
                    <a href="product_catalog.html"
                        class="hidden md:flex items-center space-x-2 text-primary hover:text-primary-600 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                        <span>Seguir Comprando</span>
                    </a>
                </div>
            </div>

            <!-- Cart Content -->
            <div class="lg:grid lg:grid-cols-3 lg:gap-8">
                <!-- Cart Items Section -->
                <div class="lg:col-span-2">
                    <!-- Delivery/Pickup Toggle -->
                    <div class="card p-4 mb-6">
                        <h3 class="font-semibold text-text-primary mb-3">Método
                            de Entrega</h3>
                        <div class="flex space-x-2">
                            <button id="deliveryBtn"
                                class="delivery-toggle flex-1 py-3 px-4 rounded-lg border-2 border-primary bg-primary text-white font-medium transition-colors touch-target">
                                <i class="fas fa-truck mr-2"></i>
                                Delivery
                            </button>
                            <button id="pickupBtn"
                                class="delivery-toggle flex-1 py-3 px-4 rounded-lg border-2 border-border text-text-primary hover:border-primary transition-colors touch-target">
                                <i class="fas fa-store mr-2"></i>
                                Retiro en Local
                            </button>
                        </div>
                    </div>

                    <!-- Cart Items -->
                    <div class="card">
                        <div class="p-4 border-b border-border-light">
                            <h2
                                class="text-lg font-semibold text-text-primary">Productos
                                en tu Carrito</h2>
                            <span id="itemCount"
                                class="text-text-secondary text-sm">0
                                productos</span>
                        </div>

                        <div id="cartItemsList"
                            class="divide-y divide-border-light">
                            <!-- Cart items will be dynamically inserted here -->
                        </div>

                        <!-- Empty Cart State -->
                        <div id="emptyCartState" class="p-8 text-center hidden">
                            <i
                                class="fas fa-shopping-cart text-4xl text-text-secondary mb-4"></i>
                            <h3
                                class="text-lg font-medium text-text-primary mb-2">Tu
                                carrito está vacío</h3>
                            <p class="text-text-secondary mb-4">Agrega algunos
                                productos deliciosos para comenzar</p>
                            <a href="product_catalog.html"
                                class="btn-primary inline-flex items-center space-x-2">
                                <img
                                    src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNGRkY0QzMiLz4KPHN2ZyB4PSI1IiB5PSI1IiB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAzMCAzMCIgZmlsbD0ibm9uZSI+CjxyZWN0IHdpZHRoPSIzMCIgaGVpZ2h0PSIyMCIgeD0iMCIgeT0iNSIgcng9IjMiIGZpbGw9IiNGRkQ3MDAiLz4KPHJlY3Qgd2lkdGg9IjMwIiBoZWlnaHQ9IjEwIiB4PSIwIiB5PSIxNSIgcng9IjMiIGZpbGw9IiNGRkQ3MDAiLz4KPHJlY3Qgd2lkdGg9IjMwIiBoZWlnaHQ9IjEwIiB4PSIwIiB5PSIyNSIgcng9IjMiIGZpbGw9IiNGRkQ3MDAiLz4KPHJlY3Qgd2lkdGg9IjMwIiBoZWlnaHQ9IjEwIiB4PSIwIiB5PSIwIiByeD0iMyIgZmlsbD0iI0ZGRDcwMCIvPgo8L3N2Zz4KPC9zdmc+"
                                    alt="Hamburguesa" class="w-6 h-6">
                                <span>Ver Menú</span>
                            </a>
                        </div>
                    </div>

                    <!-- Continue Shopping (Mobile) -->
                    <div class="mt-4 md:hidden">
                        <a href="product_catalog.html"
                            class="flex items-center justify-center space-x-2 w-full py-3 text-primary hover:text-primary-600 transition-colors">
                            <i class="fas fa-arrow-left"></i>
                            <span>Seguir Comprando</span>
                        </a>
                    </div>
                </div>

                <!-- Order Summary Sidebar -->
                <div class="lg:col-span-1 mt-6 lg:mt-0">
                    <div class="card sticky top-24">
                        <div class="p-4 border-b border-border-light">
                            <h3
                                class="text-lg font-semibold text-text-primary">Resumen
                                del Pedido</h3>
                        </div>

                        <div class="p-4 space-y-4">
                            <!-- Coupon Code -->
                            <div>
                                <label for="couponCode"
                                    class="block text-sm font-medium text-text-primary mb-2">
                                    Código de Descuento
                                </label>
                                <div class="flex space-x-2">
                                    <input type="text" id="couponCode"
                                        placeholder="Ej: BURGER10"
                                        class="input-field flex-1 text-sm" />
                                    <button id="applyCoupon"
                                        class="px-4 py-2 bg-secondary text-white rounded-lg hover:bg-secondary-600 transition-colors touch-target">
                                        Aplicar
                                    </button>
                                </div>
                                <div id="couponMessage"
                                    class="mt-2 text-sm hidden"></div>
                            </div>

                            <!-- Order Totals -->
                            <div
                                class="space-y-3 pt-4 border-t border-border-light">
                                <div
                                    class="flex justify-between text-text-primary">
                                    <span>Subtotal</span>
                                    <span id="subtotalAmount">$0</span>
                                </div>

                                <div id="shippingRow"
                                    class="flex justify-between text-text-primary">
                                    <span>Envío</span>
                                    <span id="shippingAmount">$1.500</span>
                                </div>

                                <div id="serviceFeeRow"
                                    class="flex justify-between text-text-primary hidden">
                                    <span>Cargo por Servicio (3%)</span>
                                    <span id="serviceFeeAmount">$0</span>
                                </div>

                                <div id="discountRow"
                                    class="flex justify-between text-success hidden">
                                    <span>Descuento <span
                                            id="discountCode"></span></span>
                                    <span id="discountAmount">-$0</span>
                                </div>

                                <div
                                    class="flex justify-between text-lg font-bold text-text-primary pt-3 border-t border-border-light">
                                    <span>Total</span>
                                    <span id="totalAmount">$0</span>
                                </div>
                            </div>

                            <!-- Service Fee Toggle -->
                            <div class="pt-4 border-t border-border-light">
                                <label class="flex items-center space-x-3">
                                    <input type="checkbox" id="serviceFeeToggle"
                                        class="w-4 h-4 text-primary border-border rounded focus:ring-primary" />
                                    <span
                                        class="text-sm text-text-primary">Agregar
                                        cargo por servicio (3%)</span>
                                </label>
                            </div>

                            <!-- Checkout Button -->
                            <div class="pt-4">
                                <button id="checkoutBtn"
                                    class="btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed"
                                    disabled>
                                    <i class="fas fa-credit-card mr-2"></i>
                                    Proceder al Pago
                                </button>
                            </div>

                            <!-- Estimated Delivery Time -->
                            <div id="deliveryInfo"
                                class="text-center text-sm text-text-secondary pt-2">
                                <i class="fas fa-clock mr-1"></i>
                                Tiempo estimado: 30-45 min
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast Notifications -->
        <div id="toastContainer"
            class="fixed top-20 right-4 z-50 space-y-2"></div>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="fixed inset-0 z-50 hidden">
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-black bg-opacity-50"
                id="modalBackdrop"></div>

            <!-- Modal Panel -->
            <div class="absolute inset-0 flex items-center justify-center p-4">
                <div
                    class="bg-surface rounded-xl shadow-xl max-w-sm w-full p-6">
                    <div class="text-center">
                        <i
                            class="fas fa-exclamation-triangle text-4xl text-warning mb-4"></i>
                        <h3
                            class="text-lg font-semibold text-text-primary mb-2">Confirmar
                            Eliminación</h3>
                        <p class="text-text-secondary mb-6">¿Estás seguro de que
                            quieres eliminar este producto del carrito?</p>

                        <div class="flex space-x-3">
                            <button id="cancelRemove"
                                class="flex-1 py-2 px-4 border border-border rounded-lg text-text-primary hover:bg-background transition-colors">
                                Cancelar
                            </button>
                            <button id="confirmRemove"
                                class="flex-1 py-2 px-4 bg-error text-white rounded-lg hover:bg-error-600 transition-colors">
                                Eliminar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart Item Template -->
        <template id="cartItemTemplate">
            <div class="cart-item p-4" data-product-id>
                <div class="flex space-x-4">
                    <!-- Product Image -->
                    <div class="flex-shrink-0">
                        <img class="w-16 h-16 rounded-lg object-cover" src
                            alt />
                    </div>

                    <!-- Product Details -->
                    <div class="flex-1 min-w-0">
                        <h4
                            class="font-medium text-text-primary mb-1 item-name"></h4>
                        <p
                            class="text-text-secondary text-sm mb-2 item-options"></p>

                        <!-- Quantity Controls -->
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <button
                                    class="quantity-decrease w-8 h-8 rounded-full bg-border-light text-text-primary hover:bg-primary hover:text-white transition-colors flex items-center justify-center touch-target">
                                    <i class="fas fa-minus text-xs"></i>
                                </button>
                                <span
                                    class="quantity-display font-medium text-text-primary min-w-[2rem] text-center">1</span>
                                <button
                                    class="quantity-increase w-8 h-8 rounded-full bg-border-light text-text-primary hover:bg-primary hover:text-white transition-colors flex items-center justify-center touch-target">
                                    <i class="fas fa-plus text-xs"></i>
                                </button>
                            </div>

                            <div class="flex items-center space-x-3">
                                <span
                                    class="item-total font-semibold text-primary"></span>
                                <button
                                    class="remove-item text-text-secondary hover:text-error transition-colors p-1 touch-target">
                                    <i class="fas fa-trash text-sm"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <script>
        // Cart Management
        let cart = JSON.parse(localStorage.getItem('burgerHouseCart')) || [];
        let isDelivery = true;
        let appliedCoupon = null;
        let includeServiceFee = false;
        let itemToRemove = null;

        // Coupon codes
        const coupons = {
            'BURGER10': { discount: 0.10, description: '10% de descuento' }
        };

        // DOM Elements
        const cartItemsList = document.getElementById('cartItemsList');
        const emptyCartState = document.getElementById('emptyCartState');
        const itemCount = document.getElementById('itemCount');
        const cartBadge = document.getElementById('cartBadge');
        const subtotalAmount = document.getElementById('subtotalAmount');
        const shippingAmount = document.getElementById('shippingAmount');
        const shippingRow = document.getElementById('shippingRow');
        const serviceFeeAmount = document.getElementById('serviceFeeAmount');
        const serviceFeeRow = document.getElementById('serviceFeeRow');
        const discountAmount = document.getElementById('discountAmount');
        const discountRow = document.getElementById('discountRow');
        const discountCode = document.getElementById('discountCode');
        const totalAmount = document.getElementById('totalAmount');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const deliveryInfo = document.getElementById('deliveryInfo');
        const toastContainer = document.getElementById('toastContainer');
        const confirmModal = document.getElementById('confirmModal');

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            renderCart();
            updateTotals();
            setupEventListeners();
        });

        // Event Listeners
        function setupEventListeners() {
            // Mobile menu toggle
            document.getElementById('mobileMenuToggle').addEventListener('click', function() {
                const mobileNav = document.getElementById('mobileNav');
                const mobileSearch = document.getElementById('mobileSearch');
                mobileNav.classList.toggle('hidden');
                mobileSearch.classList.toggle('hidden');
            });

            // Delivery/Pickup toggle
            document.getElementById('deliveryBtn').addEventListener('click', function() {
                setDeliveryMethod(true);
            });

            document.getElementById('pickupBtn').addEventListener('click', function() {
                setDeliveryMethod(false);
            });

            // Coupon application
            document.getElementById('applyCoupon').addEventListener('click', applyCouponCode);
            document.getElementById('couponCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    applyCouponCode();
                }
            });

            // Service fee toggle
            document.getElementById('serviceFeeToggle').addEventListener('change', function() {
                includeServiceFee = this.checked;
                updateServiceFeeDisplay();
                updateTotals();
            });

            // Checkout button
            document.getElementById('checkoutBtn').addEventListener('click', function() {
                if (cart.length > 0) {
                    // Save cart state and redirect to checkout
                    localStorage.setItem('burgerHouseCart', JSON.stringify(cart));
                    localStorage.setItem('deliveryMethod', isDelivery ? 'delivery' : 'pickup');
                    localStorage.setItem('appliedCoupon', JSON.stringify(appliedCoupon));
                    localStorage.setItem('includeServiceFee', includeServiceFee);
                    window.location.href = 'checkout_process.html';
                }
            });

            // Confirmation modal
            document.getElementById('cancelRemove').addEventListener('click', closeConfirmModal);
            document.getElementById('confirmRemove').addEventListener('click', confirmItemRemoval);
            document.getElementById('modalBackdrop').addEventListener('click', closeConfirmModal);
        }

        // Set Delivery Method
        function setDeliveryMethod(delivery) {
            isDelivery = delivery;
            
            // Update button states
            const deliveryBtn = document.getElementById('deliveryBtn');
            const pickupBtn = document.getElementById('pickupBtn');
            
            if (delivery) {
                deliveryBtn.classList.add('border-primary', 'bg-primary', 'text-white');
                deliveryBtn.classList.remove('border-border', 'text-text-primary');
                pickupBtn.classList.remove('border-primary', 'bg-primary', 'text-white');
                pickupBtn.classList.add('border-border', 'text-text-primary');
                deliveryInfo.innerHTML = '<i class="fas fa-clock mr-1"></i>Tiempo estimado: 30-45 min';
            } else {
                pickupBtn.classList.add('border-primary', 'bg-primary', 'text-white');
                pickupBtn.classList.remove('border-border', 'text-text-primary');
                deliveryBtn.classList.remove('border-primary', 'bg-primary', 'text-white');
                deliveryBtn.classList.add('border-border', 'text-text-primary');
                deliveryInfo.innerHTML = '<i class="fas fa-store mr-1"></i>Listo para retirar en 15-20 min';
            }
            
            updateTotals();
        }

        // Render Cart
        function renderCart() {
            cartItemsList.innerHTML = '';
            
            if (cart.length === 0) {
                emptyCartState.classList.remove('hidden');
                cartItemsList.classList.add('hidden');
                updateItemCount(0);
                updateCheckoutButton();
                return;
            }

            emptyCartState.classList.add('hidden');
            cartItemsList.classList.remove('hidden');

            cart.forEach(item => {
                const cartItem = createCartItem(item);
                cartItemsList.appendChild(cartItem);
            });

            updateItemCount(cart.length);
            updateCartBadge();
            updateCheckoutButton();
        }

        // Create Cart Item
        function createCartItem(item) {
            const template = document.getElementById('cartItemTemplate');
            const cartItem = template.content.cloneNode(true);
            
            const itemElement = cartItem.querySelector('.cart-item');
            itemElement.dataset.productId = item.id;

            // Set item info
            cartItem.querySelector('img').src = item.image;
            cartItem.querySelector('img').alt = item.name;
            cartItem.querySelector('.item-name').textContent = item.name;
            cartItem.querySelector('.quantity-display').textContent = item.quantity;
            cartItem.querySelector('.item-total').textContent = formatPrice(item.price * item.quantity);

            // Set options text
            const optionsText = Object.entries(item.options || {})
                .map(([key, value]) => `${key}: ${value.label}`)
                .join(', ');
            cartItem.querySelector('.item-options').textContent = optionsText || 'Sin opciones adicionales';

            // Setup quantity controls
            const decreaseBtn = cartItem.querySelector('.quantity-decrease');
            const increaseBtn = cartItem.querySelector('.quantity-increase');
            const removeBtn = cartItem.querySelector('.remove-item');

            decreaseBtn.addEventListener('click', function() {
                updateItemQuantity(item.id, -1);
            });

            increaseBtn.addEventListener('click', function() {
                updateItemQuantity(item.id, 1);
            });

            removeBtn.addEventListener('click', function() {
                showRemoveConfirmation(item.id);
            });

            return cartItem;
        }

        // Update Item Quantity
        function updateItemQuantity(productId, change) {
            const cartItemIndex = cart.findIndex(item => item.id === productId);
            
            if (cartItemIndex !== -1) {
                cart[cartItemIndex].quantity += change;
                
                if (cart[cartItemIndex].quantity <= 0) {
                    cart.splice(cartItemIndex, 1);
                    showToast('Producto eliminado del carrito');
                } else {
                    showToast('Cantidad actualizada');
                }
                
                saveCart();
                renderCart();
                updateTotals();
            }
        }

        // Show Remove Confirmation
        function showRemoveConfirmation(productId) {
            itemToRemove = productId;
            confirmModal.classList.remove('hidden');
        }

        // Close Confirmation Modal
        function closeConfirmModal() {
            confirmModal.classList.add('hidden');
            itemToRemove = null;
        }

        // Confirm Item Removal
        function confirmItemRemoval() {
            if (itemToRemove) {
                cart = cart.filter(item => item.id !== itemToRemove);
                saveCart();
                renderCart();
                updateTotals();
                showToast('Producto eliminado del carrito');
                closeConfirmModal();
            }
        }

        // Apply Coupon Code
        function applyCouponCode() {
            const couponInput = document.getElementById('couponCode');
            const couponMessage = document.getElementById('couponMessage');
            const code = couponInput.value.trim().toUpperCase();

            if (!code) {
                showCouponMessage('Ingresa un código de descuento', 'error');
                return;
            }

            if (coupons[code]) {
                appliedCoupon = { code, ...coupons[code] };
                showCouponMessage(`¡Código aplicado! ${coupons[code].description}`, 'success');
                couponInput.value = '';
                updateTotals();
            } else {
                showCouponMessage('Código de descuento inválido', 'error');
            }
        }

        // Show Coupon Message
        function showCouponMessage(message, type) {
            const couponMessage = document.getElementById('couponMessage');
            couponMessage.textContent = message;
            couponMessage.className = `mt-2 text-sm ${type === 'success' ? 'text-success' : 'text-error'}`;
            couponMessage.classList.remove('hidden');

            setTimeout(() => {
                couponMessage.classList.add('hidden');
            }, 4000);
        }

        // Update Service Fee Display
        function updateServiceFeeDisplay() {
            if (includeServiceFee) {
                serviceFeeRow.classList.remove('hidden');
            } else {
                serviceFeeRow.classList.add('hidden');
            }
        }

        // Update Totals
        function updateTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Calculate shipping
            let shipping = 0;
            if (isDelivery && subtotal < 20000) {
                shipping = 1500;
            }

            // Calculate service fee
            let serviceFee = 0;
            if (includeServiceFee) {
                serviceFee = Math.round(subtotal * 0.03);
            }

            // Calculate discount
            let discount = 0;
            if (appliedCoupon) {
                discount = Math.round(subtotal * appliedCoupon.discount);
            }

            const total = subtotal + shipping + serviceFee - discount;

            // Update display
            subtotalAmount.textContent = formatPrice(subtotal);
            shippingAmount.textContent = formatPrice(shipping);
            serviceFeeAmount.textContent = formatPrice(serviceFee);
            discountAmount.textContent = formatPrice(discount);
            totalAmount.textContent = formatPrice(total);

            // Update shipping row visibility
            if (isDelivery) {
                shippingRow.classList.remove('hidden');
                if (subtotal >= 20000) {
                    shippingAmount.innerHTML = '<span class="text-success">Gratis</span>';
                }
            } else {
                shippingRow.classList.add('hidden');
            }

            // Update discount row visibility
            if (appliedCoupon) {
                discountRow.classList.remove('hidden');
                discountCode.textContent = `(${appliedCoupon.code})`;
            } else {
                discountRow.classList.add('hidden');
            }

            updateServiceFeeDisplay();
        }

        // Update Item Count
        function updateItemCount(count) {
            itemCount.textContent = `${count} producto${count !== 1 ? 's' : ''}`;
        }

        // Update Cart Badge
        function updateCartBadge() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            if (totalItems > 0) {
                cartBadge.textContent = totalItems;
                cartBadge.classList.remove('hidden');
            } else {
                cartBadge.classList.add('hidden');
            }
        }

        // Update Checkout Button
        function updateCheckoutButton() {
            if (cart.length > 0) {
                checkoutBtn.disabled = false;
                checkoutBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                checkoutBtn.disabled = true;
                checkoutBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        // Save Cart to localStorage
        function saveCart() {
            localStorage.setItem('burgerHouseCart', JSON.stringify(cart));
        }

        // Format Price
        function formatPrice(price) {
            return new Intl.NumberFormat('es-AR', {
                style: 'currency',
                currency: 'ARS',
                minimumFractionDigits: 0
            }).format(price);
        }

        // Show Toast
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `bg-${type === 'success' ? 'success' : 'error'} text-white px-4 py-3 rounded-lg shadow-lg animate-toast-slide`;
            toast.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas fa-${type === 'success' ? 'check' : 'exclamation-triangle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }
    </script>
        <script id="dhws-dataInjector"
            src="../public/dhws-data-injector.js"></script>
    </body>
</html>